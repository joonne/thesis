\documentclass[main.tex]{thesis.tex}
\begin{document}

\chapter{Suosittelijajärjestelmät}

\textit{Suosittelulla} tarkoitetaan tehtävää, jossa tuotteita suositellaan käyttäjille.
Yksinkertaisin suosittelu tapahtuu ihmiseltä toiselle, ilman tietokoneita.
Ihmiset voivat kuitenkin tehokkaasti suositella vain niitä asioita, jotka ovat itse henkilökohtaisesti kokeneet.
Tällöin suosittelijajärjestelmistä tulee hyödyllisiä, sillä ne voivat mahdollisesti tarjota suosituksia sadoista tai jopa tuhansista erilaisista tuotteista.
Suosittelijajärjestelmät ovat joukko tekniikoita ja ohjelmistoja, jotka tarjovat suosituksia mahdollisesti hyödyllisistä tuotteista.
Tuotteella tarkoitetaan tässä yhteydessä yleistä asiaa, jota järjestelmä suosittelee henkilölle.
Suosittelujärjestelmät rakennetaan yleensä suosittelemaan vain tietyn tyyppisiä tuotteita, kuten esimerkiksi kirjoja tai elokuvia. \cite{ricci11}

Suosittelijajärjestelmien tarkoitus on auttaa asiakkaita päätöksenteossa, tuotteiden määrän ollessa valtava.
Tavallisesti suositukset ovat räätälöityjä, millä tarkoitetaan että suositukset eroavat käyttäjien tai käyttäjäryhmien välillä.
Suositukset voivat olla myös räätälöimättömiä ja niiden tuottaminen onkin usein yksinkertaisempaa.
Lista, joka sisältää 10 suosituinta tuotetta, on esimerkki räätälöimättömästä suosittelusta.
Järjestäminen tehdään ennustamalla kaikista sopivimmat tuotteet käyttäjän mieltymysten tai vaatimusten perusteella.
Tämän mahdollistamiseksi suosittelijajärjestelmän on kerättävä käyttäjältä tämän mieltymykset.
Mieltymykset voivat olla suoraan käyttäjältä kysyttyjä tai käyttäjän antamia tuotearvioita tai ne voidaan tulkita käyttäjän toiminnasta kuten klikkauksista, sivun katselukerroista tai ajasta jonka käyttäjä on viipynyt tietyllä tuotesivulla.
Suosittelijajärjestelmä voisi esimerkiksi tulkita tuotesivulle päätymisen todisteeksi mieltymyksestä sivun tuotteista. \cite{ricci11}

Suosittelijajärjestelmien kehitys alkoi melko yksinkertaisesta havainnosta: ihmiset tapaavat luottaa toisten ihmisten suosituksiin tehdessään rutiininomaisia päätöksiä.
On esimerkiksi yleistä luottaa vertaispalautteeseen valittaessa kirjaa luettavaksi tai luottaa elokuvakriitikoiden kirjoittamiin arvioihin.
Ensimmäinen suosittelijajärjestelmä yritti matkia tätä käytöstä etsimällä yhteisöstä suosituksia aktiiviselle käyttäjälle.
Suositukset haettiin käyttämällä algoritmeja.
Tämä lähestymistapa on tyypiltään yhteisösuodattamista.
Yhteisösuodattamisessa ideana on että, jos käyttäjät pitivät samankaltaisista tuotteista aikaisemmin, he luultavasti pitävät samoja tuotteita ostaneiden henkilöiden suosituksia merkityksellisinä. \cite{ricci11}

Verkkokauppojen kehityksen myötä syntyi tarve suosittelulle vaihtoehtojen rajoittamiseksi.
Käyttäjät kokivat aina vain vaikeammaksi löytää oikeat tuotteet sivustojen suurista valikoimista.
Tiedon määrän räjähdysmäinen kasvaminen internetissä on ajanut käyttäjät tekemään huonoja päätöksiä.
Vaihtoehdot ovat hyväksi, mutta vaihtoehtojen lisääntyminen on alkanut hyödyn tuottamisen sijaan heikentää kuluttajien hyvinvointia. \cite{ricci11}

Viimeaikoina suosittelijajärjestelmät ovat osoittautuneet tehokkaaksi lääkkeeksi tiedon \textit{ylimääräongelmaa} vastaan.
Suosittelijajärjestelmät käsittelevät tätä ilmiötä tarjoamalla uusia, aiemmin tuntemattomia, tuotteita jotka ovat todennäköisesti merkityksellisiä käyttäjälle tämän nykyisessä tehtävässä.
Kun käyttäjä pyytää suosituksia, suosittelujärjestelmä tuottaa suosituksia käyttämällä tietoa ja tuntemusta käyttäjistä, saatavilla olevista tuotteista ja aiemmista \textit{tapahtumista} (transactions).
Tutkittuaan tarjotut suositukset, käyttäjä voi hyväksyä tai hylätä ne tarjoten epäsuoraa ja täsmällistä palautetta suosittelijalle.
Tätä uutta tietoa voidaan myöhemmin käyttää hyödyksi tuotettaessa uusia suosituksia seuraaviin käyttäjän ja järjestelmän vuorovaikutuksiin. \cite{ricci11}

Verrattuna klassisten tietojärjestelmien, kuten tietokantojen ja hakukoneiden, tutkimukseen, suosittelijajärjestelmien tutkimus on verrattain tuoretta.
Suositteljiajärjestelmistä tuli itsenäisiä tutkimusalueita 90-luvun puolivälissä.
Viimeaikoina mielenkiinto suosittelujärjestelmiä kohtaan on kasvanut merkittävästi.
Esimerkiksi verkkosivustoissa, kuten Amazon.com, YouTube, Netflix sekä IMDB, suosittelujärjestelmillä on iso rooli.
Suosittelujärjestelmien tutkimiseen ja kehittämiseen omistettuja konferensseja on myös olemassa, kuten RecSys ja AI Communications (2008). \cite{ricci11}

Suosittelujärjestelmällä voidaan ajatella olevan kaksi päätarkoitusta: palveluntarjoajan avustaminen ja arvon tuottaminen palvelun käyttäjälle.
Suosittelujärjestelmän on siis tasapainoiteltava sekä palveluntarjoajan että käyttäjän tarpeiden välillä. \cite{ricci11}
Palveluntarjoaja voi esimerkiksi ottaa suosittelujärjestelmän avuksi parantamaan tai monipuolistamaan myyntiä, lisäämään käyttäjien tyytyväisyyttä, lisäämään käyttäjien uskollisuutta tai ymmärtämään paremmin mitä käyttäjä haluaa \cite{ricci11}.
Käyttäjä puolestaan saattaa haluta suosituksena tuotesarjan, apua selaamiseen tai mahdollistaa muihin vaikuttamisen. \cite{ricci11}

GroupLens \cite{aggarwal16}, BookLens \cite{booklens17} ja MovieLens \cite{movieLens17} olivat uranuurtajia suosittelujärjestelmien tutkimisessa ja kehittämisessä.
GroupLens on tutkimuslaboratorio \textit{computer science and engineering} -laitoksella Minnesotan Yliopistossa, joka on erikoistunut muun muassa suosittelujärjestelmiin ja verkkoyhteisöihin \cite{aggarwal16}.
BookLens on on GroupLensin rakentama kirjojen suosittelujärjestelmä \cite{booklens17}.
MovieLens on GroupLensin ylläpitämä elokuvien suosittelujärjestelmä \cite{movieLens17}.
Uranuurtavan tutkimuksen lisäksi nämä sivustot julkaisivat kaikkien saataville aineistoja, joka ei ollut yleistä tuohon aikaan. \cite{aggarwal16}

\section{Suositustekniikat}

Suosittelujärjestelmällä täytyy olla ymmärrys tuotteista, jotta se pystyy tekemään suosituksia.
Tämän mahdollistamiseksi järjestelmän täytyy pystyä ennustamaan tuotteen käytännöllisyys tai ainakin verrata tuotteiden hyödyllisyyttä ja tämän perusteella päättää suositeltavat tuotteet.
Ennustamista voidaan luonnostella yksinkertaisella personoimattomalla suosittelualgoritmilla, joka suosittelee vain suosituimpia elokuvia.
Tätä lähestymistapaa voidaan perustella sillä, että tarkemman tiedon puuttuessa käyttäjän mieltymyksistä, elokuva, josta muutkin ovat pitäneet on todennäköisesti myös keskivertokäyttäjän mieleen, ainakin enemmän kuin satunaisesti valikoitu elokuva.
Suosittujen elokuvien voidaan siis katsoa olevan kohtuullisen osuvia suosituksia keskivertokäyttäjälle. \cite{ricci11}

Tuotteen $i$ hyödyllisyyttä käyttäjälle $u$ voidaan mallintaa reaaliarvoisella funktiolla $R(u,i)$, kuten yleensä tehdään \textit{yhteisösuodatuksessa} ottamalla huomioon käyttäjien antamat arviot tuotteista.
Yhteisösuodatuksessa suosittelijan perustehtävä on ennustaa $R$:n arvoa käyttäjä-tuote pareille ja laskea arvio todelliselle funktiolle $R$.
Laskiessaan tätä ennustetta käyttäjälle $u$ ja tuotejoukolle, järjestelmä suosittelee tuotteita, joilla on suurin ennustettu hyödyllisyys.
Ennustettujen tuotteiden määrä on usein paljon pienempi kuin tuotteiden koko määrä, joten voidaan sanoa, että suosittelijajärjestelmä suodattaa käyttäjälle suositeltavat tuotteet. \cite{ricci11}

Suosittelijajärjestelmät eroavat toisistaan kohdistetun toimialan, käytetyn tiedon ja erityisesti siinä kuinka suositukset tehdään, jolla tarkoitetaan suosittelualgoritmia \cite{ricci11}.
Tässä työssä keskitytään vain yhteen suosittelutekniikoiden luokkkaan, yhteisösuodatukseen, sillä tätä menetelmää käytetään Apache Sparkin MLlib kirjastossa.

Yhteisöllistä suodatusta käyttävät suosittelijajärjestelmät perustuvat käyttäjien yhteistyöhön.
Niiden tavoitteena on tunnistaa malleja käyttäjän mielenkiinnoista voidakseen tehdä suunnattuja suosituksia \cite{aberger14}.
Tämän lähestymistavan alkuperäisessä toteutuksessa suositellaan aktiiviselle käyttäjälle niitä tuotteita, joita muut samankaltaiset käyttäjät ovat pitäneet aiemmin \cite{ricci11}.
Käyttäjä arvostelee tuotteita.
Seuraavaksi algoritmi etsii suosituksia perustuen käyttäjiin, jotka ovat ostaneet samanlaisia tuotteita tai perustuen tuotteisiin, jotka ovat eniten samanlaisia käyttäjän ostoshistoriaan verrattuna.
Yhteisösuodatus voidaan jakaa kahteen kategoriaan, jotka ovat \textit{tuotepohjainen- ja käyttäjäpohjainen yhteisösuodatus}.
Yhteisösuodatus on eniten käytetty ja toteutettu tekniikka suositusjärjestelmissä \cite{gorakala15} \cite{ricci11} \cite{burke02}.

Yhteisöllinen suodatus analysoi käyttäjien välisiä suhteita ja tuotteiden välisiä riippuvuuksia tunnistaakseen uusia käyttäjä-tuote -assosiaatioita \cite{korenBellVolinsky09}.
Päätelmä siitä, että käyttäjät voisivat pitää samasta laulusta, koska molemmat kuuntelevat muita samankaltaisia lauluja on esimerkki yhteisöllisestä suodatuksesta \cite{ryza15}.

Koska yhteisöllisessä suodatuksessa suosittelu perustuu pelkästään käyttäjän arvosteluihin tuotteesta, yhteisöllinen suodatus kärsii ongelmista jotka tunnetaan nimillä \textit{uusi käyttäjäongelma} ja \textit{uusi tuoteongelma} \cite{gorakala15}.
Ellei käyttäjä ole arvostellut yhtään tuotetta, algoritmi ei kykene tuottamaan myöskään yhtään suositusta.
Muita yhteisöllisen suodatuksen haasteita ovat \textit{kylmä aloitus} sekä \textit{niukkuus} (sparsity).
Kylmällä aloituksella tarkoitetaan sitä, että tarkkojen suositusten tuottamiseen tarvitaan tyypillisesti suuri määrä dataa.
Niukkuudella tarkoitetaan sitä, että tuotteiden määrä ylittää usein käyttäjien määrän.
Tästä johtuen suhteiden määrä on todella niukka, sillä useat käyttäjät ovat arvostelleet tai ostaneet vain murto-osan tuotteiden koko määrästä. \cite{aberger14}

\subsection{Muistiperustainen yhteisöllinen suodatus}

\textit{Muistiperustaisissa menetelmissä} käyttäjä-tuote -suosituksia käytetään suoraan uusien tuotteiden ennustamiseksi.
Tämä voidaan toteuttaa kahdella tavalla, käyttäjäpohjaisena suositteluna tai tuotepohjaisena suositteluna.

Seuraavat kappaleet kuvaavat käyttäjäpohjaista yhteisösuodatusta ja tuotepohjaista yhteisösuodatusta.
Ohjelmat 3.1, 3.2 ja 3.3 on luonnosteltu tekstipohjaisten selitysten perusteella käyttäen Scala-syntaksia.

\subsubsection{Tuotepohjainen yhteisösuodatus}

Tuotepohjaisessa yhteisösuodatuksessa (Item-based collaborative filtering, IBCF) algoritmi aloittaa etsimällä samankaltaisia tuotteita käyttäjän ostoshistoriasta \cite{gorakala15}.
Seuraavaksi mallinnetaan käyttäjän mieltymykset tuotteelle perustuen saman käyttäjän tekemiin arvosteluihin \cite{ricci11}.
Alla oleva ohjelma 3.1 esittelee tuotepohjaisen yhteisösuodatuksen idean jokaiselle uudelle käyttäjälle.

\definecolor{scalacomment}{rgb}{0,0.6,0}

\lstset{
	columns=flexible,
	breaklines=true,
	tabsize=2,
	language=Scala,
	commentstyle=\color{scalacomment},
	keywordstyle=\color{blue},
	numbers=left,
	numbersep=15pt,
}

\begin{lstlisting}[caption=Tuotepohjaisen yhteisösuodatuksen algoritmi \cite{gorakala15}]
// Jokaiselle kahdelle tuotteelle,
// mittaa kuinka samankaltaisia ne ovat saatujen arvioiden suhteen.
// Samankaltaisuutta voidaan arvioida esimerkiksi kosinimitan avulla.

case class Item(id: Int, feature1: String, feature2: String)
val items: Seq[Item] = Seq(Item(), Item(), Item())
case class Similarity(item1: Item, item2: Item, similarity: Double)

val similarItems: Seq[Similarity] = items.map { item1 =>
	items.map { item2 =>
	  Similarity (item1, item2, cosineSimilarity(item1, item2))
	}
}

// Tunnista k samankaltaisinta tuotetta jokaiselle tuotteelle

case class Similarities(item: Item, kMostSimilarItems: Seq[Similarity])
val similarities = findKMostSimilarItems(similarItems)

// Jokaiselle käyttäjälle, tunnista tuotteet,
// jotka ovat eniten samankaltaisia käyttäjän ostoshistorian kanssa.

val similars = users.map { user =>
	user.purchases.map { purchase => findSimilarItem(purchase, similarities) }
}

\end{lstlisting}

Amerikan suurimman verkkokaupan, Amazon.com:in, on aiemmin tiedetty käyttäneen tuote-tuotteeseen-yhteisösuodatusta.
Tässä toteutuksessa algoritmi rakentaa samankaltaisten tuotteiden taulun etsimällä tuotteita, joita käyttäjät tapaavat ostaa yhdessä.
Seuraavaksi algoritmi etsii käyttäjän ostoshistoriaa ja arvosteluita vastaavat tuotteet, yhdistää nämä tuotteet ja palauttaa suosituimmat tai eniten korreloivat tuotteet. \cite{linden03}

\subsubsection{Käyttäjäpohjainen yhteisösuodatus}

Tuotepohjaisessa yhteisösuodatuksessa (User-based collaborative filtering, UBCF) algoritmi aloittaa etsimällä samankaltaisimmat käyttäjät.
Seuraava askel on arvostella samankaltaisten käyttäjien ostamat tuotteet.
Lopuksi valitaan parhaan arvosanan saaneet tuotteet.
Samankaltaisuus saadaan laskettua vertaamalla käyttäjien ostoshistorioiden samankaltaisuutta. \cite{ricci11}

Askeleet jokaiselle uudelle käyttäjälle käyttäjäpohjaisessa yhteisösuodatuksessa ovat:

\lstset{
	columns=flexible,
	breaklines=true,
	tabsize=2,
	language=Scala,
	commentstyle=\color{scalacomment},
	keywordstyle=\color{blue},
	numbers=left,
	numbersep=15pt,
}

\begin{lstlisting}[caption=Käyttäjäpohjainen yhteisösuodatus algoritmi osa 1/2 \cite{gorakala15}]
// Mittaa jokaisen käyttäjän samankaltaisuus uuteen käyttäjään
//  Kuten IBCF:ssä, suosittuja samankaltaisuusarvioita ovat korrelaatio
// sekä kosinimitta.

case class Similarity(userId1: Int, userId2: Int, score: Int)

val newUser: User = User("Adam", 31, purchases)
val similarities = users.map { user =>
	Similarity(newUser.id, user.id, cosineSimilarity(user, newUser)
}

// Tunnista samankaltaisimmat käyttäjät.
// Vaihtoehtoja on kaksi: Voidaan valita joko parhaat k käyttäjää
// (k-nearest neighbors) tai voidaan valita käyttäjät,
// joiden samankaltaisuus ylittää tietyn kynnysarvon.

val mostSimilarUsers = similarities.filter(_.score > 0.8)

\end{lstlisting}

\newpage

\lstset{
	columns=flexible,
	breaklines=true,
	tabsize=2,
	language=Scala,
	commentstyle=\color{scalacomment},
	keywordstyle=\color{blue},
	numbers=left,
	numbersep=15pt,
}

\begin{lstlisting}[caption=Käyttäjäpohjainen yhteisösuodatus algoritmi osa 2/2 \cite{gorakala15}]
// Arvostele samankaltaisimpien käyttäjien ostamat tuotteet.
// Arvostelu saadaan joko keskiarvona kaikista tai painotettuna keskiarvona,
// käyttäen samankaltaisuuksia painoina.

val ratedItems = mostSimilarUsers.map { user =>
	user.purchases.map { purchase =>
		val purchases = mostSimilarUsers.map { usr =>
			usr.purchases.filter(_.id == purchase.id)
		}
		purchases.sum() / purchases.size
	}
}

// Valitse parhaiten arvostellut tuotteet.

val topRatedItems = ratedItems.take(10)

\end{lstlisting}

\subsection{Mallipohjainen yhteisösuodatus}

Muistipohjaisen yhteisösuodatuksen käyttäessä tallennettuja suosituksia suoraan ennustamisen apuna, mallipohjaisissa lähestymistavoissa näitä arvosteluita käytetään ennustavan mallin oppimiseen.
Perusajatus on mallintaa käyttäjä-tuote-vuorovaikutuksia tekijöillä jotka edustavat käyttäjien ja tuotteiden piileviä ominaisuuksia (latent factors) järjestelmässä.
Piileviä ominaisuuksia ovat esimerkiksi käyttäjän mieltymykset ja tuotteiden kategoriat.
Tämä malli opetetaan käyttämällä saatavilla olevaa dataa ja myöhemmin käytetään ennustamaan käyttäjien arvioita uusille tuotteille. \cite{ricci11}
ALS-algoritmi on esimerkki mallipohjaisesta yhteisösuodatusalgoritmista.

\end{document}